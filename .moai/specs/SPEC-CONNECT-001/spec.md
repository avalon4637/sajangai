---
id: SPEC-CONNECT-001
version: "1.0.0"
status: draft
created: "2026-02-20"
priority: P2
depends_on:
  - SPEC-IMPORT-001
---

# SPEC-CONNECT-001: 카드매출 자동 연계

## 개요

여신금융협회 Open API 또는 중개 API 플랫폼(하이픈/CODEF)을 통해 카드사 매출 데이터를 자동으로 조회하고 sajang.ai에 연계하는 시스템. 사용자가 수동으로 CSV를 다운로드/업로드할 필요 없이 자동으로 카드매출을 수집한다.

## 범위

- 카드매출 연계 설정 페이지 (API 계정 연결)
- 자동/수동 데이터 동기화
- 10개 카드사 승인/매입/입금 정보 조회
- 조회된 데이터를 revenues 테이블에 자동 저장
- KPI 자동 재계산

## 범위 제외

- 배달앱 매출 연동 (SPEC-DELIVERY-001)
- PG사 결제 연동
- 세금계산서 연동

---

## Requirements (EARS)

### REQ-01: 연계 방식 선택

**Ubiquitous:**
- 시스템은 카드매출 연계 방식을 선택할 수 있어야 한다:
  - 옵션 A: 여신금융협회 ID 직접 연동 (무료, 심사 필요)
  - 옵션 B: 중개 API 플랫폼 연동 (유료, 즉시 사용)

### REQ-02: 계정 연결

**Event-Driven:**
- WHEN 사용자가 여신금융협회 ID/PW를 입력하면 THEN 시스템은 계정 유효성을 검증해야 한다.

**Ubiquitous:**
- 시스템은 인증 정보를 안전하게 암호화하여 저장해야 한다.
- 시스템은 연결 상태(정상/오류/만료)를 표시해야 한다.

### REQ-03: 데이터 동기화

**Event-Driven:**
- WHEN 사용자가 "동기화" 버튼을 클릭하면 THEN 시스템은 카드매출 데이터를 조회하여 DB에 저장해야 한다.

**Ubiquitous:**
- 시스템은 조회 기간(최근 1개월, 3개월, 6개월)을 선택할 수 있어야 한다.
- 시스템은 중복 데이터를 자동으로 필터링해야 한다.

### REQ-04: 자동 동기화 (선택)

**Optional:**
- 가능하면 일/주 단위 자동 동기화 스케줄링을 제공한다.

### REQ-05: 데이터 매핑

**Ubiquitous:**
- 시스템은 카드매출 데이터를 기존 categories.ts의 채널/카테고리에 자동 매핑해야 한다.
- 매핑 규칙: 카드사 → "카드" 채널, 가맹점 유형에 따른 카테고리 분류

---

## 기술 조사 결과

### 여신금융협회 Open API

- URL: https://openapi.crefia.or.kr
- 데이터: 승인정보(매출금액, 거래일자), 매입정보(수수료, 지급금액), 입금정보(입금예정금액, 입금예정일)
- 이용 대상: 핀테크 기업 (이용기관 심사 필요)
- 비용: 무료

### 중개 API 플랫폼

- 하이픈(HYPHEN): 카드매출 + 배달앱 + 홈택스 통합 API
- CODEF: 은행/카드사/공공기관 데이터 구독형 API
- 바로빌: 카드사 스크래핑 기반 사용내역 API

### 아키텍처 고려사항

- API Key/Secret 관리: Supabase Vault 또는 환경변수
- 인증정보 암호화: AES-256
- 백그라운드 동기화: Vercel Cron Jobs 또는 Supabase Edge Functions
- Rate Limiting: API 호출 제한 준수

---

## 선행 과제

1. API 플랫폼 선정 및 계약
2. 핀테크 기업 등록 (여신금융협회 직접 연동 시)
3. 보안 아키텍처 설계 (인증정보 암호화)

<!-- TAG: SPEC-CONNECT-001 -->
